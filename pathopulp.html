<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pathopulp - Auto-Apprentissage (v9 Matrice Stricte)</title>
    <style>
        :root {
            --primary: #2c3e50;
            --success: #27ae60; /* Vert pour OUI */
            --danger: #c0392b;  /* Rouge pour NON */
            --variable: #e67e22; /* Orange pour OUI/NON */
            --solution: #8e44ad; /* Violet pour la Solution */
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: #f4f4f4;
            color: #333;
        }
        
        /* Colonne GAUCHE : Questions */
        .col-questions {
            width: 35%;
            background: white;
            border-right: 1px solid #ccc;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }
        .q-btn {
            width: 100%;
            padding: 10px 15px;
            margin-bottom: 8px;
            text-align: left;
            background: white;
            border: 1px solid #ddd;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.2s;
            font-size: 0.95em;
        }
        .q-btn:hover { background: #eef2f5; border-color: var(--primary); padding-left: 20px;}
        .q-btn.asked { opacity: 0.5; background: #eee; cursor: not-allowed; border-color: transparent;}

        /* Colonne DROITE : R√©ponses & Diagnostic */
        .col-interaction {
            width: 65%;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        /* Zone de LOG (Chat) */
        #log-container {
            flex: 1;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
        }
        .log-entry { margin-bottom: 12px; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; }
        .log-q { font-weight: bold; color: #555; margin-bottom: 4px; font-size: 0.9em; }
        
        /* STYLES DES R√âPONSES (OUI / NON / VARIABLE) */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        .b-oui { background-color: var(--success); }
        .b-non { background-color: var(--danger); }
        .b-var { background-color: var(--variable); } /* LE FAMEUX OUI/NON */

        /* Zone Solution affich√©e */
        .solution-reveal {
            background-color: #f3e5f5;
            border: 2px solid var(--solution);
            color: var(--solution);
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 1.2em;
            animation: fadeIn 0.5s;
        }

        /* Zone de Validation */
        .validation-area {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        select { flex: 1; padding: 10px; font-size: 1em; border: 1px solid #ccc; border-radius: 4px;}
        
        button { border: none; padding: 0 20px; font-weight: bold; cursor: pointer; border-radius: 4px; transition: 0.2s; }
        
        #btn-valid { background: var(--primary); color: white; }
        #btn-valid:hover { background: #1a252f; }
        
        #btn-sol { background: var(--variable); color: white; }
        #btn-sol:hover { background: #d35400; }

        /* Header */
        h2 { margin-top: 0; color: var(--primary); font-size: 1.4em; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-reset { background: #95a5a6; color: white; padding: 8px 12px; font-size: 0.9em; }
        .btn-reset:hover { background: #7f8c8d; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="col-questions">
    <div class="header-bar">
        <h2>P@THOPULP</h2>
        <button class="btn-reset" onclick="initGame()">Nouveau Patient ‚Üª</button>
    </div>
    <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">Cliquez sur une question pour l'ajouter au dossier.</div>
    <div id="questions-list">
        </div>
</div>

<div class="col-interaction">
    <h2>Dossier M√©dical</h2>
    
    <div id="log-container">
        </div>

    <div class="validation-area">
        <select id="diag-select">
            <option value="" disabled selected>-- Choisir le diagnostic --</option>
            </select>
        <button id="btn-valid" onclick="checkDiagnosis()">VALIDER</button>
        <button id="btn-sol" onclick="showSolution()">SOLUTION</button>
    </div>
</div>

<script>
    // =========================================================
    // DONN√âES DU PDF (Matrice Stricte)
    // =========================================================
    const PATIENT_DATA = [
        {
            id: 1, name: "Dent saine",
            data: { motif: "NON", spontanee: "NON", provoquee: "NON", vitalite: "OUI", prolonge: "NON", prolonge1: "NON", prolonge2: "NON", percussion: "NON", tumefaction: "NON", radio_apicale: "NON" }
        },
        {
            id: 2, name: "Exposition dentinaire",
            data: { motif: "OUI", spontanee: "NON", provoquee: "OUI", vitalite: "OUI", contamination: "OUI", percussion: "NON" }
        },
        {
            id: 3, name: "Pulpite aigu√´ r√©versible",
            data: { motif: "OUI", spontanee: "NON", provoquee: "OUI", vitalite: "OUI", contamination: "OUI", prolonge: "NON", percussion: "OUI/NON" }
        },
        {
            id: 4, name: "Pulpite aigu√´ irr√©versible",
            data: { motif: "OUI", spontanee: "OUI", provoquee: "OUI", vitalite: "OUI", contamination: "OUI", prolonge: "OUI", prolonge1: "NON", prolonge2: "OUI", percussion: "OUI" }
        },
        {
            id: 9, name: "Pulpite chronique irr√©versible",
            data: { motif: "NON", spontanee: "NON", provoquee: "OUI", vitalite: "OUI", contamination: "OUI", prolonge: "OUI", prolonge1: "NON", prolonge2: "OUI", percussion: "NON" }
        },
        {
            id: 12, name: "Pulpite chronique hyperplasique",
            data: { motif: "NON", spontanee: "NON", provoquee: "OUI", vitalite: "OUI", contamination: "OUI", polype: "OUI" }
        },
        {
            id: 10, name: "Pulpite chr. (d√©g√©n√©rescence calcique)",
            data: { motif: "NON", spontanee: "NON", provoquee: "OUI", vitalite: "OUI", contamination: "OUI", radio_calc: "OUI" }
        },
        {
            id: 11, name: "Pulpite chr. (r√©sorption interne)",
            data: { motif: "NON", spontanee: "NON", provoquee: "OUI", vitalite: "OUI", contamination: "OUI", radio_resorp: "OUI" }
        },
        {
            id: 14, name: "N√©crose asymptomatique",
            data: { motif: "NON", spontanee: "NON", vitalite: "NON", contamination: "OUI", percussion: "NON", tumefaction: "NON", fistule: "NON", radio_apicale: "NON" }
        },
        {
            id: 5, name: "Parodontite apicale aigu√´",
            data: { motif: "OUI", spontanee: "OUI", provoquee: "OUI", vitalite: "NON", contamination: "OUI", percussion: "OUI", tumefaction: "NON", radio_apicale: "NON" }
        },
        {
            id: 13, name: "Parodontite apicale chronique",
            data: { motif: "NON", spontanee: "NON", provoquee: "OUI/NON", vitalite: "NON", contamination: "OUI", percussion: "NON", fistule: "NON", radio_apicale: "OUI" }
        },
        {
            id: 15, name: "Parodontite apicale chr. suppur√©e",
            data: { motif: "NON", spontanee: "NON", provoquee: "NON", vitalite: "NON", contamination: "OUI", percussion: "NON", fistule: "OUI", radio_apicale: "OUI" }
        },
        {
            id: 6, name: "Abc√®s apical aigu",
            data: { motif: "OUI", spontanee: "OUI", provoquee: "OUI", vitalite: "NON", contamination: "OUI", percussion: "OUI", tumefaction: "OUI", fistule: "NON", radio_apicale: "NON", palpation: "OUI" }
        },
        {
            id: 8, name: "Abc√®s parodontal",
            data: { 
                motif: "OUI", 
                spontanee: "OUI", 
                provoquee: "OUI", 
                vitalite: "OUI", 
                poche: "OUI", 
                tumefaction: "OUI", 
                fistule: "OUI",
                percussion: "OUI", 
                papille: "OUI",
                radio_apicale: "NON", 
                radio_septale: "OUI" 
            }
        },
        {
            id: 7, name: "Syndrome du septum",
            data: { motif: "OUI", spontanee: "OUI", provoquee: "OUI", vitalite: "OUI", papille: "OUI", percussion: "OUI", radio_septale: "OUI" }
        },
        {
            id: 16, name: "Hypersensibilit√© dentinaire",
            // MIS A JOUR SELON MATRICE STRICTE
            data: { motif: "OUI", spontanee: "OUI", provoquee: "OUI", vitalite: "OUI", percussion: "OUI", radio_apicale: "NON" }
        },
        {
            id: 17, name: "Parodontite traumatique",
            // MIS A JOUR SELON MATRICE STRICTE
            data: { motif: "OUI/NON", spontanee: "NON", provoquee: "OUI/NON", vitalite: "OUI", percussion: "NON", radio_apicale: "NON" }
        }
    ];

    // QUESTIONS
    const QUESTIONS = [
        { id: 1, text: "La douleur est-elle le motif de consultation ?", key: "motif" },
        { id: 2, text: "Y a t-il une douleur provoqu√©e au froid ?", key: "provoquee" },
        { id: 3, text: "Y a t-il une douleur provoqu√©e au chaud ?", key: "provoquee" },
        { id: 4, text: "Y a t-il une douleur provoqu√©e au sucre ?", key: "provoquee" },
        { id: 5, text: "Y a t-il une douleur provoqu√©e √† la mastication ?", key: "provoquee" },
        { id: 6, text: "Y a t-il une douleur √† la morsure ?", key: "percussion" }, // Note: Morsure est souvent li√© √† la percussion/pression
        { id: 7, text: "Y a t-il une douleur spontan√©e ?", key: "spontanee" },
        { id: 8, text: "Y a t-il une tum√©faction ?", key: "tumefaction" },
        
        { id: 9, text: "Y a t-il une voie de contamination bact√©rienne ?", key: "contamination" },
        
        { id: 10, text: "Y a t-il une r√©ponse au test de vitalit√© ?", key: "vitalite" },
        
        { id: 11, text: "La r√©ponse au test de vitalit√© se prolonge-t-elle ?", key: "prolonge" },
        { id: 12, text: "La r√©ponse se prolonge un peu ?", key: "prolonge1" },     
        { id: 13, text: "La r√©ponse se prolonge longtemps ?", key: "prolonge2" }, 
        
        { id: 14, text: "La percussion est elle douloureuse ?", key: "percussion" },
        { id: 25, text: "La palpation apicale est-elle douloureuse ?", key: "palpation" },

        { id: 16, text: "La compression de la papille est elle douloureuse ?", key: "papille" },
        { id: 17, text: "Y a t-il un ostium fistulaire ?", key: "fistule" },
        { id: 18, text: "Y a t-il une poche parodontale ?", key: "poche" },
        { id: 19, text: "Y a t-il une image radio septale ?", key: "radio_septale" },
        { id: 20, text: "Y a t-il une image radioclaire apicale ?", key: "radio_apicale" },
        { id: 22, text: "Radio : d√©g√©n√©rescence calcique ?", key: "radio_calc" },
        { id: 23, text: "Radio : r√©sorption interne ?", key: "radio_resorp" },
        { id: 24, text: "Y a t-il un polype pulpaire ?", key: "polype" }
    ];

    // MOTEUR
    let currentPathology = null;
    let gameActive = true;

    function initGame() {
        gameActive = true;
        const randIndex = Math.floor(Math.random() * PATIENT_DATA.length);
        currentPathology = PATIENT_DATA[randIndex];
        console.log("Debug Solution:", currentPathology.name); 

        // Reset UI
        document.getElementById("log-container").innerHTML = '<p style="color:#888; font-style: italic;">Le patient est install√©. Posez une question...</p>';
        document.getElementById("diag-select").value = "";
        document.getElementById("btn-valid").disabled = false;
        document.getElementById("btn-sol").disabled = false;
        
        // Liste Questions
        const qList = document.getElementById("questions-list");
        qList.innerHTML = "";
        QUESTIONS.forEach(q => {
            const btn = document.createElement("button");
            btn.className = "q-btn";
            btn.id = `q-${q.id}`;
            btn.textContent = `${q.id}. ${q.text}`;
            btn.onclick = () => ask(q.id);
            qList.appendChild(btn);
        });

        // Select Diagnostic
        const dSelect = document.getElementById("diag-select");
        if (dSelect.options.length <= 1) {
            const sorted = [...PATIENT_DATA].sort((a,b) => a.name.localeCompare(b.name));
            sorted.forEach(d => {
                const opt = document.createElement("option");
                opt.value = d.id;
                opt.textContent = d.name;
                dSelect.appendChild(opt);
            });
        }
    }

    function ask(qId) {
        if (!gameActive) return;
        const btn = document.getElementById(`q-${qId}`);
        if (btn.classList.contains("asked")) return;
        
        const question = QUESTIONS.find(q => q.id === qId);
        let reponse = currentPathology.data[question.key];
        
        // Si la donn√©e n'est pas sp√©cifi√©e pour cette maladie, on consid√®re NON par d√©faut
        if (!reponse) reponse = "NON";

        const log = document.getElementById("log-container");
        if (log.children.length > 0 && log.children[0].tagName === "P") log.innerHTML = "";

        const div = document.createElement("div");
        div.className = "log-entry";
        
        let badgeClass = "b-non";
        if (reponse === "OUI") badgeClass = "b-oui";
        if (reponse === "OUI/NON") badgeClass = "b-var";

        div.innerHTML = `<div class="log-q">${question.text}</div><span class="badge ${badgeClass}">${reponse}</span>`;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;

        btn.classList.add("asked");
    }

    function checkDiagnosis() {
        if (!gameActive) return;
        const select = document.getElementById("diag-select");
        const val = parseInt(select.value);
        
        if (!val) {
            alert("Veuillez choisir un diagnostic dans la liste.");
            return;
        }

        if (val === currentPathology.id) {
            // Victoire
            const log = document.getElementById("log-container");
            const div = document.createElement("div");
            div.className = "solution-reveal";
            div.style.borderColor = "#27ae60";
            div.style.color = "#27ae60";
            div.innerHTML = "‚úÖ BRAVO !<br>C'est bien : <strong>" + currentPathology.name + "</strong>";
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
            endGame();
        } else {
            alert("Ce n'est pas le bon diagnostic. Continuez vos recherches !");
        }
    }

    function showSolution() {
        if (!gameActive) return;
        if (!confirm("Voulez-vous vraiment abandonner et voir la r√©ponse ?")) return;

        const log = document.getElementById("log-container");
        const div = document.createElement("div");
        div.className = "solution-reveal";
        div.innerHTML = "üí° SOLUTION :<br>Le diagnostic √©tait : <strong>" + currentPathology.name + "</strong>";
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
        
        endGame();
    }

    function endGame() {
        gameActive = false;
        document.getElementById("btn-valid").disabled = true;
        document.getElementById("btn-sol").disabled = true;
        // Griser toutes les questions
        const btns = document.querySelectorAll(".q-btn");
        btns.forEach(b => b.classList.add("asked"));
    }

    initGame();
</script>
</body>
</html>
